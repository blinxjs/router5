!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";var e={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},t={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},a=function(e){return function(){return e}},n=function(){},r={},o=r="undefined"!=typeof window&&window.history?{getBase:function(){return window.location.pathname.replace(/\/$/,"")},pushState:function(e,t,a){return window.history.pushState(e,t,a)},replaceState:function(e,t,a){return window.history.replaceState(e,t,a)},addPopstateListener:function(e){return window.addEventListener("popstate",e)},removePopstateListener:function(e){return window.removeEventListener("popstate",e)},getLocation:function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),""))||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:a(""),pushState:n,replaceState:n,addPopstateListener:n,removePopstateListener:n,getLocation:a(""),getState:a(null),getHash:a("")},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!0},u="popstate";return function(){function a(a){function n(e,t,a){var n=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,o=!0===c.mergeState?s({},r.getState(),n):n;a?r.replaceState(o,"",t):r.pushState(o,"",t)}function o(o){var p=a.getState(),l=!o.state||!o.state.name,S=l?a.matchPath(r.getLocation(c),u):a.makeState(o.state.name,o.state.params,o.state.path,o.state.meta.params,u,o.state.meta.id),f=i.defaultRoute,h=i.defaultParams;S?p&&a.areStatesEqual(S,p,!1)||a.transitionToState(S,p,T,function(r,o){if(r)if(r.redirect){var i=r.redirect,u=i.name,c=i.params;a.navigate(u,c,s({},T,{replace:!0,force:!0}))}else if(r.code===e.CANNOT_DEACTIVATE){var d=a.buildUrl(p.name,p.params);l||n(S,d,!0)}else f&&a.navigate(f,h,s({},T,{reload:!0,replace:!0}));else a.invokeEventListeners(t.TRANSITION_SUCCESS,o,p,{replace:!0})}):f&&a.navigateToDefault(s({},T,{reload:!0,replace:!0}))}var i=a.getOptions(),p=a.start;return function(e,t){function a(e){var a=e.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(a?a[1]:e).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+e);var r=n[1],o=n[2]||"",s=n[3]||"";return(t.useHash?o.replace(new RegExp("^#"+t.hashPrefix),""):t.base?r.replace(new RegExp("^"+t.base),""):r)+s}e.urlToPath=a,e.buildUrl=function(a,n){var r=t.base||"",o=t.useHash?"#"+t.hashPrefix:"",s=e.buildPath(a,n);return null===s?null:r+o+s},e.matchUrl=function(t){return e.matchPath(a(t))}}(a,c),a.start=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length||"function"==typeof t[0]?p.apply(void 0,[r.getLocation(c)].concat(t)):p.apply(void 0,t),a},a.replaceHistoryState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.buildState(e,t),o=a.buildUrl(e,t);a.lastKnownState=n,r.replaceState(n,"",o)},{onStart:function(){c.useHash&&!c.base&&(c.base=r.getBase()),r.addPopstateListener(o)},onStop:function(){r.removePopstateListener(o)},onTransitionSuccess:function(e,t,o){var s=r.getState(),i=s&&s.meta&&s.name&&s.params,u=t&&a.areStatesEqual(t,e,!1),T=o.replace||!i||u,p=a.buildUrl(e.name,e.params);null===t&&!1===c.useHash&&!0===c.preserveHash&&(p+=r.getHash()),n(e,p,T)},onPopState:o}}var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,c=s({},i,n),T={forceDeactivate:c.forceDeactivate,source:u};return a.pluginName="BROWSER_PLUGIN",a}});
